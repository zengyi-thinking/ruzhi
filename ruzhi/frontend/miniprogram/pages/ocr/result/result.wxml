<!--OCRè¯†åˆ«ç»“æœé¡µé¢-->
<view class="result-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="result-header">
    <view class="header-title">
      <text class="title-icon">âœ¨</text>
      <text class="title-text">è¯†åˆ«ç»“æœ</text>
    </view>
    <view class="result-meta">
      <view class="meta-item">
        <text class="meta-label">ç½®ä¿¡åº¦:</text>
        <text class="meta-value confidence">{{ocrResult.confidence}}%</text>
      </view>
      <view class="meta-item">
        <text class="meta-label">å¤„ç†æ—¶é—´:</text>
        <text class="meta-value">{{ocrResult.processing_time}}ms</text>
      </view>
    </view>
  </view>

  <!-- è¯†åˆ«æ–‡æœ¬ -->
  <view class="text-section">
    <view class="section-header">
      <text class="section-title">è¯†åˆ«æ–‡æœ¬</text>
      <view class="text-actions">
        <button class="action-btn" bindtap="onCopyText">
          <text class="btn-icon">ğŸ“‹</text>
          <text>å¤åˆ¶</text>
        </button>
        <button class="action-btn" bindtap="onEditText">
          <text class="btn-icon">âœï¸</text>
          <text>ç¼–è¾‘</text>
        </button>
      </view>
    </view>

    <view class="text-content">
      <textarea
        wx:if="{{editMode}}"
        class="text-editor"
        value="{{editedText}}"
        bindinput="onTextInput"
        placeholder="è¯·è¾“å…¥æ–‡æœ¬å†…å®¹"
        auto-height
        maxlength="5000"
      />
      <view wx:else class="text-display ancient-text">
        {{ocrResult.text}}
      </view>
    </view>

    <view wx:if="{{editMode}}" class="edit-actions">
      <button class="save-btn" bindtap="onSaveEdit">ä¿å­˜ä¿®æ”¹</button>
      <button class="cancel-btn" bindtap="onCancelEdit">å–æ¶ˆ</button>
    </view>
  </view>

  <!-- å¼‚ä½“å­—è¯†åˆ«ç»“æœ -->
  <view wx:if="{{ocrResult.variants && ocrResult.variants.length > 0}}" class="variants-section">
    <view class="section-title">å¼‚ä½“å­—è¯†åˆ«</view>
    <view class="variants-list">
      <view
        wx:for="{{ocrResult.variants}}"
        wx:key="index"
        class="variant-item"
      >
        <view class="variant-original">{{item.original}}</view>
        <text class="variant-arrow">â†’</text>
        <view class="variant-standard">{{item.standard}}</view>
        <view class="variant-confidence">{{item.confidence}}%</view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-section">
    <button class="primary-btn" bindtap="onAnalyzeText">
      <text class="btn-icon">ğŸ”</text>
      <text>æ™ºèƒ½åˆ†æ</text>
    </button>
    <button class="secondary-btn" bindtap="onSaveToFavorites">
      <text class="btn-icon">â­</text>
      <text>æ”¶è—</text>
    </button>
    <button class="secondary-btn" bindtap="onShareResult">
      <text class="btn-icon">ğŸ“¤</text>
      <text>åˆ†äº«</text>
    </button>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view wx:if="{{recommendations.length > 0}}" class="recommendations-section">
    <view class="section-title">ç›¸å…³æ¨è</view>
    <view class="recommendations-list">
      <view
        wx:for="{{recommendations}}"
        wx:key="id"
        class="recommendation-item"
        bindtap="onRecommendationClick"
        data-item="{{item}}"
      >
        <view class="recommendation-title">{{item.title}}</view>
        <view class="recommendation-desc">{{item.description}}</view>
        <view class="recommendation-tags">
          <text
            wx:for="{{item.tags}}"
            wx:for-item="tag"
            wx:key="*this"
            class="tag"
          >
            {{tag}}
          </text>
        </view>
      </view>
    </view>
  </view>
</view>

<!-- åˆ†æç»“æœå¼¹çª— -->
<view class="analysis-modal {{showAnalysis ? 'show' : ''}}" wx:if="{{showAnalysis}}">
  <view class="modal-mask" bindtap="onHideAnalysis"></view>
  <view class="modal-content">
    <view class="modal-header">
      <view class="modal-title">æ™ºèƒ½åˆ†æç»“æœ</view>
      <button class="close-btn" bindtap="onHideAnalysis">âœ•</button>
    </view>

    <view class="modal-body">
      <view wx:if="{{analysisResult.keywords && analysisResult.keywords.length > 0}}" class="analysis-section">
        <view class="analysis-title">å…³é”®è¯</view>
        <view class="keywords-list">
          <text
            wx:for="{{analysisResult.keywords}}"
            wx:key="*this"
            class="keyword-tag"
          >
            {{item}}
          </text>
        </view>
      </view>

      <view wx:if="{{analysisResult.source}}" class="analysis-section">
        <view class="analysis-title">å‡ºå¤„</view>
        <view class="source-info">
          <view class="source-title">{{analysisResult.source.title}}</view>
          <view class="source-author">{{analysisResult.source.author}}</view>
          <view class="source-dynasty">{{analysisResult.source.dynasty}}</view>
        </view>
      </view>

      <view wx:if="{{analysisResult.explanation}}" class="analysis-section">
        <view class="analysis-title">é‡Šä¹‰</view>
        <view class="explanation-text">{{analysisResult.explanation}}</view>
      </view>

      <view wx:if="{{analysisResult.translation}}" class="analysis-section">
        <view class="analysis-title">ç°ä»£è¯‘æ–‡</view>
        <view class="translation-text">{{analysisResult.translation}}</view>
      </view>
    </view>
  </view>
</view>