<!--ç½‘ç»œè¿æ¥æµ‹è¯•é¡µé¢-->
<view class="network-test-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-content">
      <text class="page-title">ğŸŒ ç½‘ç»œè¿æ¥æµ‹è¯•</text>
      <text class="page-desc">æ£€æµ‹å°ç¨‹åºä¸åç«¯æœåŠ¡çš„è¿æ¥çŠ¶æ€</text>
    </view>
  </view>

  <!-- è¿æ¥çŠ¶æ€æ¦‚è§ˆ -->
  <view class="status-overview">
    <view class="status-card {{overallStatus === 'success' ? 'success' : overallStatus === 'warning' ? 'warning' : 'error'}}">
      <view class="status-icon">
        <text wx:if="{{overallStatus === 'success'}}">âœ…</text>
        <text wx:elif="{{overallStatus === 'warning'}}">âš ï¸</text>
        <text wx:else>âŒ</text>
      </view>
      <view class="status-content">
        <text class="status-title">{{statusTitle}}</text>
        <text class="status-desc">{{statusDesc}}</text>
      </view>
      <view class="status-score">
        <text class="score-number">{{successRate}}</text>
        <text class="score-unit">%</text>
      </view>
    </view>
  </view>

  <!-- æµ‹è¯•é¡¹ç›®åˆ—è¡¨ -->
  <view class="test-items-section">
    <view class="section-header">
      <text class="section-title">ğŸ“‹ æµ‹è¯•é¡¹ç›®</text>
      <button class="refresh-btn" bindtap="onRunAllTests" disabled="{{testing}}">
        {{testing ? 'æµ‹è¯•ä¸­...' : 'é‡æ–°æµ‹è¯•'}}
      </button>
    </view>

    <view class="test-items-list">
      <!-- åŸºç¡€è¿æ¥æµ‹è¯• -->
      <view class="test-item">
        <view class="test-header" bindtap="onToggleDetails" data-test="basic">
          <view class="test-info">
            <text class="test-icon">ğŸ”—</text>
            <view class="test-content">
              <text class="test-title">åŸºç¡€è¿æ¥</text>
              <text class="test-desc">åç«¯æœåŠ¡è¿æ¥çŠ¶æ€</text>
            </view>
          </view>
          <view class="test-status">
            <text class="status-icon {{testResults.basic.status}}">
              {{testResults.basic.status === 'success' ? 'âœ…' : testResults.basic.status === 'loading' ? 'â³' : 'âŒ'}}
            </text>
            <text class="expand-icon {{testResults.basic.expanded ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>
        
        <view class="test-details {{testResults.basic.expanded ? 'show' : ''}}">
          <view class="detail-item">
            <text class="detail-label">æœåŠ¡åœ°å€:</text>
            <text class="detail-value">{{apiBase}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å“åº”æ—¶é—´:</text>
            <text class="detail-value">{{testResults.basic.responseTime || '--'}}ms</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">çŠ¶æ€ç :</text>
            <text class="detail-value">{{testResults.basic.statusCode || '--'}}</text>
          </view>
          <view class="detail-item" wx:if="{{testResults.basic.error}}">
            <text class="detail-label">é”™è¯¯ä¿¡æ¯:</text>
            <text class="detail-value error">{{testResults.basic.error}}</text>
          </view>
        </view>
      </view>

      <!-- AIæœåŠ¡æµ‹è¯• -->
      <view class="test-item">
        <view class="test-header" bindtap="onToggleDetails" data-test="ai">
          <view class="test-info">
            <text class="test-icon">ğŸ¤–</text>
            <view class="test-content">
              <text class="test-title">AIæœåŠ¡</text>
              <text class="test-desc">DeepSeek APIè¿æ¥æµ‹è¯•</text>
            </view>
          </view>
          <view class="test-status">
            <text class="status-icon {{testResults.ai.status}}">
              {{testResults.ai.status === 'success' ? 'âœ…' : testResults.ai.status === 'loading' ? 'â³' : 'âŒ'}}
            </text>
            <text class="expand-icon {{testResults.ai.expanded ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>
        
        <view class="test-details {{testResults.ai.expanded ? 'show' : ''}}">
          <view class="detail-item">
            <text class="detail-label">APIçŠ¶æ€:</text>
            <text class="detail-value">{{testResults.ai.apiStatus || '--'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ¨¡å‹:</text>
            <text class="detail-value">{{testResults.ai.model || '--'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æµ‹è¯•å›å¤:</text>
            <text class="detail-value">{{testResults.ai.testResponse || '--'}}</text>
          </view>
          <view class="detail-item" wx:if="{{testResults.ai.error}}">
            <text class="detail-label">é”™è¯¯ä¿¡æ¯:</text>
            <text class="detail-value error">{{testResults.ai.error}}</text>
          </view>
        </view>
      </view>

      <!-- OCRæœåŠ¡æµ‹è¯• -->
      <view class="test-item">
        <view class="test-header" bindtap="onToggleDetails" data-test="ocr">
          <view class="test-info">
            <text class="test-icon">ğŸ“·</text>
            <view class="test-content">
              <text class="test-title">OCRæœåŠ¡</text>
              <text class="test-desc">å›¾ç‰‡è¯†åˆ«åŠŸèƒ½æµ‹è¯•</text>
            </view>
          </view>
          <view class="test-status">
            <text class="status-icon {{testResults.ocr.status}}">
              {{testResults.ocr.status === 'success' ? 'âœ…' : testResults.ocr.status === 'loading' ? 'â³' : 'âŒ'}}
            </text>
            <text class="expand-icon {{testResults.ocr.expanded ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>
        
        <view class="test-details {{testResults.ocr.expanded ? 'show' : ''}}">
          <view class="detail-item">
            <text class="detail-label">æœåŠ¡çŠ¶æ€:</text>
            <text class="detail-value">{{testResults.ocr.serviceStatus || '--'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ”¯æŒæ ¼å¼:</text>
            <text class="detail-value">{{testResults.ocr.supportedFormats || '--'}}</text>
          </view>
          <view class="detail-item" wx:if="{{testResults.ocr.error}}">
            <text class="detail-label">é”™è¯¯ä¿¡æ¯:</text>
            <text class="detail-value error">{{testResults.ocr.error}}</text>
          </view>
        </view>
      </view>

      <!-- æ•°æ®åº“è¿æ¥æµ‹è¯• -->
      <view class="test-item">
        <view class="test-header" bindtap="onToggleDetails" data-test="database">
          <view class="test-info">
            <text class="test-icon">ğŸ—„ï¸</text>
            <view class="test-content">
              <text class="test-title">æ•°æ®åº“</text>
              <text class="test-desc">æ•°æ®å­˜å‚¨æœåŠ¡æµ‹è¯•</text>
            </view>
          </view>
          <view class="test-status">
            <text class="status-icon {{testResults.database.status}}">
              {{testResults.database.status === 'success' ? 'âœ…' : testResults.database.status === 'loading' ? 'â³' : 'âŒ'}}
            </text>
            <text class="expand-icon {{testResults.database.expanded ? 'expanded' : ''}}">â–¼</text>
          </view>
        </view>
        
        <view class="test-details {{testResults.database.expanded ? 'show' : ''}}">
          <view class="detail-item">
            <text class="detail-label">è¿æ¥çŠ¶æ€:</text>
            <text class="detail-value">{{testResults.database.connectionStatus || '--'}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ•°æ®åº“ç±»å‹:</text>
            <text class="detail-value">{{testResults.database.dbType || '--'}}</text>
          </view>
          <view class="detail-item" wx:if="{{testResults.database.error}}">
            <text class="detail-label">é”™è¯¯ä¿¡æ¯:</text>
            <text class="detail-value error">{{testResults.database.error}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç½‘ç»œä¿¡æ¯ -->
  <view class="network-info-section">
    <view class="section-title">ğŸ“Š ç½‘ç»œä¿¡æ¯</view>
    <view class="info-grid">
      <view class="info-item">
        <text class="info-label">ç½‘ç»œç±»å‹</text>
        <text class="info-value">{{networkInfo.networkType}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">ä¿¡å·å¼ºåº¦</text>
        <text class="info-value">{{networkInfo.signalStrength}}</text>
      </view>
      <view class="info-item">
        <text class="info-label">å»¶è¿Ÿ</text>
        <text class="info-value">{{networkInfo.latency}}ms</text>
      </view>
      <view class="info-item">
        <text class="info-label">å¸¦å®½</text>
        <text class="info-value">{{networkInfo.bandwidth}}</text>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn secondary-btn" bindtap="onExportReport">å¯¼å‡ºæŠ¥å‘Š</button>
    <button class="action-btn primary-btn" bindtap="onRunAllTests" disabled="{{testing}}">
      {{testing ? 'æµ‹è¯•ä¸­...' : 'é‡æ–°æµ‹è¯•'}}
    </button>
  </view>

  <!-- æµ‹è¯•å†å² -->
  <view class="test-history-section" wx:if="{{testHistory.length > 0}}">
    <view class="section-title">ğŸ“ˆ æµ‹è¯•å†å²</view>
    <view class="history-list">
      <view class="history-item" wx:for="{{testHistory}}" wx:key="timestamp">
        <view class="history-time">{{item.time}}</view>
        <view class="history-result">
          <text class="result-text {{item.success ? 'success' : 'error'}}">
            {{item.success ? 'æˆåŠŸ' : 'å¤±è´¥'}}
          </text>
          <text class="result-rate">{{item.successRate}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¸®åŠ©ä¿¡æ¯ -->
  <view class="help-section">
    <view class="help-card">
      <text class="help-title">ğŸ’¡ æµ‹è¯•è¯´æ˜</text>
      <view class="help-content">
        <text class="help-text">â€¢ åŸºç¡€è¿æ¥ï¼šæµ‹è¯•å°ç¨‹åºä¸åç«¯æœåŠ¡çš„ç½‘ç»œè¿æ¥</text>
        <text class="help-text">â€¢ AIæœåŠ¡ï¼šéªŒè¯DeepSeek APIçš„å¯ç”¨æ€§å’Œå“åº”</text>
        <text class="help-text">â€¢ OCRæœåŠ¡ï¼šæ£€æŸ¥å›¾ç‰‡è¯†åˆ«åŠŸèƒ½çš„æœåŠ¡çŠ¶æ€</text>
        <text class="help-text">â€¢ æ•°æ®åº“ï¼šç¡®è®¤æ•°æ®å­˜å‚¨æœåŠ¡çš„è¿æ¥çŠ¶æ€</text>
      </view>
    </view>
  </view>
</view>
