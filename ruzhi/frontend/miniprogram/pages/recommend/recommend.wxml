<!--æ™ºèƒ½å…¸ç±æ¨èé¡µé¢-->
<view class="recommend-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-content">
      <text class="page-title">ğŸ¤– æ™ºèƒ½æ¨è</text>
      <text class="page-desc">AIä¸ºæ‚¨é‡èº«å®šåˆ¶çš„å­¦ä¹ å†…å®¹</text>
    </view>
  </view>

  <!-- ä¸ªæ€§åŒ–è®¾ç½® -->
  <view class="settings-section" wx:if="{{showSettings}}">
    <view class="settings-card">
      <view class="settings-header">
        <text class="settings-title">ğŸ“‹ ä¸ªæ€§åŒ–è®¾ç½®</text>
        <text class="settings-close" bindtap="onCloseSettings">å®Œæˆ</text>
      </view>
      
      <!-- å­¦ä¹ æ°´å¹³ -->
      <view class="setting-group">
        <text class="group-title">å­¦ä¹ æ°´å¹³</text>
        <view class="level-options">
          <view 
            class="level-option {{userPreferences.level === item.value ? 'active' : ''}}"
            wx:for="{{levelOptions}}"
            wx:key="value"
            bindtap="onLevelChange"
            data-level="{{item.value}}"
          >
            <text class="level-icon">{{item.icon}}</text>
            <text class="level-text">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- å…´è¶£åå¥½ -->
      <view class="setting-group">
        <text class="group-title">å…´è¶£åå¥½</text>
        <view class="interest-tags">
          <view 
            class="interest-tag {{userPreferences.interests.includes(item) ? 'active' : ''}}"
            wx:for="{{interestOptions}}"
            wx:key="*this"
            bindtap="onInterestToggle"
            data-interest="{{item}}"
          >
            {{item}}
          </view>
        </view>
      </view>

      <!-- å­¦ä¹ ç›®æ ‡ -->
      <view class="setting-group">
        <text class="group-title">å­¦ä¹ ç›®æ ‡</text>
        <view class="goal-options">
          <view 
            class="goal-option {{userPreferences.goals.includes(item.value) ? 'active' : ''}}"
            wx:for="{{goalOptions}}"
            wx:key="value"
            bindtap="onGoalToggle"
            data-goal="{{item.value}}"
          >
            <text class="goal-icon">{{item.icon}}</text>
            <text class="goal-text">{{item.label}}</text>
          </view>
        </view>
      </view>

      <!-- å­¦ä¹ æ—¶é—´ -->
      <view class="setting-group">
        <text class="group-title">æ¯æ—¥å­¦ä¹ æ—¶é—´</text>
        <view class="time-slider">
          <slider 
            value="{{userPreferences.dailyTime}}" 
            min="10" 
            max="120" 
            step="10"
            show-value
            bindchange="onTimeChange"
            activeColor="#667eea"
          />
          <text class="time-unit">åˆ†é’Ÿ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨èå†…å®¹ -->
  <view class="recommendations-section" wx:if="{{!showSettings}}">
    <!-- ä»Šæ—¥æ¨è -->
    <view class="today-recommend">
      <view class="section-header">
        <text class="section-title">ğŸŒŸ ä»Šæ—¥ä¸ºæ‚¨æ¨è</text>
        <text class="refresh-btn" bindtap="onRefreshRecommendations">åˆ·æ–°</text>
      </view>
      
      <view class="recommend-card main-card" wx:if="{{todayRecommend}}">
        <image class="recommend-image" src="{{todayRecommend.image}}" mode="aspectFill" />
        <view class="recommend-content">
          <text class="recommend-title">{{todayRecommend.title}}</text>
          <text class="recommend-author">{{todayRecommend.author}}</text>
          <text class="recommend-desc">{{todayRecommend.description}}</text>
          
          <view class="recommend-meta">
            <view class="meta-item">
              <text class="meta-icon">â­</text>
              <text class="meta-text">åŒ¹é…åº¦ {{todayRecommend.matchScore}}%</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">â±ï¸</text>
              <text class="meta-text">{{todayRecommend.estimatedTime}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">ğŸ“Š</text>
              <text class="meta-text">{{todayRecommend.difficulty}}</text>
            </view>
          </view>
          
          <view class="recommend-reason">
            <text class="reason-label">æ¨èç†ç”±ï¼š</text>
            <text class="reason-text">{{todayRecommend.reason}}</text>
          </view>
          
          <view class="recommend-actions">
            <button class="action-btn secondary-btn" bindtap="onCollectRecommend" data-item="{{todayRecommend}}">
              {{todayRecommend.collected ? 'å·²æ”¶è—' : 'æ”¶è—'}}
            </button>
            <button class="action-btn primary-btn" bindtap="onStartReading" data-item="{{todayRecommend}}">
              å¼€å§‹é˜…è¯»
            </button>
          </view>
        </view>
      </view>
    </view>

    <!-- åˆ†ç±»æ¨è -->
    <view class="category-recommendations">
      <view class="category-tabs">
        <text 
          class="tab-item {{currentCategory === item.id ? 'active' : ''}}"
          wx:for="{{categoryTabs}}"
          wx:key="id"
          bindtap="onCategoryChange"
          data-category="{{item.id}}"
        >
          {{item.name}}
        </text>
      </view>

      <view class="category-content">
        <view 
          class="recommend-item"
          wx:for="{{categoryRecommendations}}"
          wx:key="id"
          bindtap="onRecommendClick"
          data-item="{{item}}"
        >
          <image class="item-image" src="{{item.image}}" mode="aspectFill" />
          <view class="item-content">
            <text class="item-title">{{item.title}}</text>
            <text class="item-author">{{item.author}}</text>
            <view class="item-tags">
              <text class="tag" wx:for="{{item.tags}}" wx:key="*this">{{item}}</text>
            </view>
            <view class="item-meta">
              <text class="match-score">åŒ¹é… {{item.matchScore}}%</text>
              <text class="read-time">{{item.estimatedTime}}</text>
            </view>
          </view>
          <view class="item-actions">
            <text class="collect-btn {{item.collected ? 'collected' : ''}}" bindtap="onQuickCollect" data-item="{{item}}">
              {{item.collected ? 'ğŸ’–' : 'ğŸ¤'}}
            </text>
          </view>
        </view>
      </view>
    </view>

    <!-- å­¦ä¹ è·¯å¾„ -->
    <view class="learning-path-section">
      <view class="section-header">
        <text class="section-title">ğŸ›¤ï¸ æ¨èå­¦ä¹ è·¯å¾„</text>
        <text class="path-info">åŸºäºæ‚¨çš„æ°´å¹³å®šåˆ¶</text>
      </view>
      
      <view class="path-timeline">
        <view 
          class="path-item {{item.completed ? 'completed' : ''}} {{item.current ? 'current' : ''}}"
          wx:for="{{learningPath}}"
          wx:key="id"
          bindtap="onPathItemClick"
          data-item="{{item}}"
        >
          <view class="path-marker">
            <text class="marker-icon">{{item.completed ? 'âœ“' : item.current ? 'ğŸ“' : 'â—‹'}}</text>
          </view>
          <view class="path-content">
            <text class="path-title">{{item.title}}</text>
            <text class="path-desc">{{item.description}}</text>
            <view class="path-meta">
              <text class="path-level">{{item.level}}</text>
              <text class="path-time">{{item.estimatedTime}}</text>
            </view>
          </view>
          <view class="path-progress" wx:if="{{item.progress > 0}}">
            <text class="progress-text">{{item.progress}}%</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç›¸ä¼¼ç”¨æˆ·æ¨è -->
    <view class="similar-users-section">
      <view class="section-header">
        <text class="section-title">ğŸ‘¥ ç›¸ä¼¼ç”¨æˆ·ä¹Ÿåœ¨è¯»</text>
        <text class="users-info">å‘ç°æ›´å¤šå¥½å†…å®¹</text>
      </view>
      
      <scroll-view class="similar-scroll" scroll-x="true" show-scrollbar="false">
        <view class="similar-list">
          <view 
            class="similar-item"
            wx:for="{{similarUsersReading}}"
            wx:key="id"
            bindtap="onSimilarItemClick"
            data-item="{{item}}"
          >
            <image class="similar-image" src="{{item.image}}" mode="aspectFill" />
            <view class="similar-content">
              <text class="similar-title">{{item.title}}</text>
              <view class="similar-users">
                <image 
                  class="user-avatar" 
                  wx:for="{{item.readers}}" 
                  wx:key="id"
                  wx:for-item="user"
                  src="{{user.avatar}}" 
                  mode="aspectFill" 
                />
                <text class="users-count">+{{item.readersCount}}äººåœ¨è¯»</text>
              </view>
            </view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-toolbar">
    <view class="toolbar-item" bindtap="onShowSettings">
      <text class="toolbar-icon">âš™ï¸</text>
      <text class="toolbar-text">åå¥½è®¾ç½®</text>
    </view>
    <view class="toolbar-item" bindtap="onViewHistory">
      <text class="toolbar-icon">ğŸ“š</text>
      <text class="toolbar-text">é˜…è¯»å†å²</text>
    </view>
    <view class="toolbar-item" bindtap="onViewCollections">
      <text class="toolbar-icon">ğŸ’–</text>
      <text class="toolbar-text">æˆ‘çš„æ”¶è—</text>
    </view>
    <view class="toolbar-item" bindtap="onGenerateReport">
      <text class="toolbar-icon">ğŸ“Š</text>
      <text class="toolbar-text">æ¨èæŠ¥å‘Š</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner">ğŸ¤–</view>
    <text class="loading-text">AIæ­£åœ¨åˆ†ææ‚¨çš„åå¥½...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !todayRecommend}}">
    <view class="empty-icon">ğŸ¤–</view>
    <text class="empty-title">æš‚æ— æ¨èå†…å®¹</text>
    <text class="empty-desc">å®Œå–„æ‚¨çš„åå¥½è®¾ç½®ï¼Œè·å¾—æ›´ç²¾å‡†çš„æ¨è</text>
    <button class="empty-btn" bindtap="onShowSettings">è®¾ç½®åå¥½</button>
  </view>
</view>
