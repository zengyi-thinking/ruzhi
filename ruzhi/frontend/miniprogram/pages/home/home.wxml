<!--é¦–é¡µæ¨¡æ¿-->
<view class="home-container">
  <!-- é¡¶éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="user-header">
    <view class="user-info" bindtap="onUserAvatarClick">
      <image 
        class="user-avatar" 
        src="{{hasUserInfo ? userInfo.avatarUrl : '/images/default-avatar.png'}}"
        mode="aspectFill"
      />
      <view class="user-details">
        <text class="user-name">{{hasUserInfo ? userInfo.nickName : 'ç‚¹å‡»ç™»å½•'}}</text>
        <text class="user-desc">{{hasUserInfo ? 'ç»§ç»­å­¦ä¹ ä¼ ç»Ÿæ–‡åŒ–' : 'å¼€å¯æ™ºæ…§ä¹‹æ—…'}}</text>
      </view>
    </view>
    <view class="header-actions">
      <text class="icon-bell">ğŸ””</text>
    </view>
  </view>

  <!-- å­¦ä¹ ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card card" bindtap="onViewStudyStats">
    <view class="stats-header">
      <text class="stats-title">å­¦ä¹ ç»Ÿè®¡</text>
      <text class="icon-arrow">â†’</text>
    </view>
    <view class="stats-content">
      <view class="stat-item">
        <text class="stat-number">{{studyStats.totalDays}}</text>
        <text class="stat-label">å­¦ä¹ å¤©æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{studyStats.completedChapters}}</text>
        <text class="stat-label">å®Œæˆç« èŠ‚</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{studyStats.ocrCount}}</text>
        <text class="stat-label">è¯†åˆ«æ¬¡æ•°</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{studyStats.totalHours}}</text>
        <text class="stat-label">å­¦ä¹ æ—¶é•¿(h)</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½æ¨¡å— -->
  <view class="features-section">
    <view class="section-header">
      <text class="section-title">æ ¸å¿ƒåŠŸèƒ½</text>
    </view>
    <view class="features-grid">
      <view 
        class="feature-item" 
        wx:for="{{features}}" 
        wx:key="id"
        data-feature="{{item}}"
        bindtap="onFeatureClick"
      >
        <view class="feature-icon" style="background-color: {{item.color}}20;">
          <image src="{{item.icon}}" class="feature-image" mode="aspectFit" />
        </view>
        <text class="feature-title">{{item.title}}</text>
        <text class="feature-desc">{{item.desc}}</text>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥æ¨è -->
  <view class="recommend-section" wx:if="{{todayRecommend.length > 0}}">
    <view class="section-header">
      <text class="section-title">ä»Šæ—¥æ¨è</text>
      <text class="section-more" bindtap="onViewMoreRecommend">æŸ¥çœ‹æ›´å¤š</text>
    </view>
    <scroll-view class="recommend-scroll" scroll-x="true" show-scrollbar="false">
      <view class="recommend-list">
        <view 
          class="recommend-item" 
          wx:for="{{todayRecommend}}" 
          wx:key="id"
          data-item="{{item}}"
          bindtap="onRecommendClick"
        >
          <image src="{{item.image}}" class="recommend-image" mode="aspectFill" />
          <view class="recommend-content">
            <text class="recommend-title">{{item.title}}</text>
            <text class="recommend-text ancient-text">{{item.content}}</text>
            <view class="recommend-meta">
              <text class="recommend-reason">{{item.reason}}</text>
              <text class="recommend-time">{{item.readTime}}</text>
            </view>
          </view>
          <view class="recommend-badge" wx:if="{{item.isNew}}">æ–°</view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æ¯æ—¥ä¸€å¥ -->
  <view class="daily-quote-section" wx:if="{{dailyQuote}}">
    <view class="quote-card" bindtap="onQuoteClick">
      <view class="quote-header">
        <text class="quote-label">ğŸ“– æ¯æ—¥ä¸€å¥</text>
        <text class="quote-date">{{dailyQuote.date}}</text>
      </view>
      <text class="quote-content">{{dailyQuote.content}}</text>
      <view class="quote-footer">
        <text class="quote-author">â€”â€” {{dailyQuote.author}}</text>
        <text class="quote-source">ã€Š{{dailyQuote.source}}ã€‹</text>
      </view>
      <view class="quote-action">
        <text class="action-text">ç‚¹å‡»æŸ¥çœ‹è¯¦è§£</text>
        <text class="action-icon">â€º</text>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ æ‰“å¡ -->
  <view class="checkin-section">
    <view class="section-header">
      <text class="section-title">ğŸ“… å­¦ä¹ æ‰“å¡</text>
      <text class="checkin-streak">è¿ç»­{{learningStreak}}å¤©</text>
    </view>

    <view class="checkin-card">
      <view class="checkin-calendar">
        <view
          class="calendar-day {{item.status}}"
          wx:for="{{weekDays}}"
          wx:key="date"
        >
          <text class="day-label">{{item.label}}</text>
          <view class="day-dot"></view>
        </view>
      </view>

      <view class="checkin-actions">
        <button
          class="checkin-btn {{todayChecked ? 'checked' : ''}}"
          bindtap="onDailyCheckin"
          disabled="{{todayChecked}}"
        >
          {{todayChecked ? 'ä»Šæ—¥å·²æ‰“å¡' : 'ç«‹å³æ‰“å¡'}}
        </button>
        <view class="checkin-reward" wx:if="{{todayChecked}}">
          <text class="reward-text">è·å¾—ç§¯åˆ† +{{dailyPoints}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- AIåˆ›æ–°åŠŸèƒ½ -->
  <view class="ai-features-section">
    <view class="section-header">
      <text class="section-title">âœ¨ AIåˆ›æ–°ä½“éªŒ</text>
      <text class="section-subtitle">è®©ä¼ ç»Ÿæ–‡åŒ–å­¦ä¹ æ›´æœ‰è¶£</text>
    </view>

    <view class="ai-features-list">
      <view class="ai-feature-card" bindtap="onAIFeatureClick" data-feature="challenge">
        <view class="ai-feature-header">
          <view class="ai-feature-icon">ğŸ¯</view>
          <view class="ai-feature-badge">çƒ­é—¨</view>
        </view>
        <text class="ai-feature-title">å…¸ç±é—®ç­”æŒ‘æˆ˜</text>
        <text class="ai-feature-desc">AIç”Ÿæˆé¢˜ç›®ï¼Œæ¸¸æˆåŒ–å­¦ä¹ å…¸ç±çŸ¥è¯†</text>
        <view class="ai-feature-stats">
          <text class="stat-item">ğŸ“Š å·²æœ‰{{challengeStats.totalUsers}}äººå‚ä¸</text>
          <text class="stat-item">ğŸ† æœ€é«˜åˆ†{{challengeStats.highestScore}}</text>
        </view>
      </view>

      <view class="ai-feature-card" bindtap="onAIFeatureClick" data-feature="recommend">
        <view class="ai-feature-header">
          <view class="ai-feature-icon">ğŸ¤–</view>
          <view class="ai-feature-badge">æ™ºèƒ½</view>
        </view>
        <text class="ai-feature-title">æ™ºèƒ½å…¸ç±æ¨è</text>
        <text class="ai-feature-desc">AIåˆ†æåå¥½ï¼Œä¸ªæ€§åŒ–æ¨èå­¦ä¹ å†…å®¹</text>
        <view class="ai-feature-stats">
          <text class="stat-item">ğŸ¯ åŒ¹é…åº¦{{recommendStats.accuracy}}%</text>
          <text class="stat-item">ğŸ“š æ¨è{{recommendStats.totalBooks}}æœ¬</text>
        </view>
      </view>

      <view class="ai-feature-card" bindtap="onAIFeatureClick" data-feature="modernize">
        <view class="ai-feature-header">
          <view class="ai-feature-icon">âœ¨</view>
          <view class="ai-feature-badge">åˆ›æ–°</view>
        </view>
        <text class="ai-feature-title">å¤æ–‡ç°ä»£åŒ–æ”¹å†™</text>
        <text class="ai-feature-desc">AIå°†å¤æ–‡æ”¹å†™ä¸ºç°ä»£æ–‡ï¼Œä¿æŒåŸæ„æ›´æ˜“æ‡‚</text>
        <view class="ai-feature-stats">
          <text class="stat-item">ğŸ”„ å·²æ”¹å†™{{modernizeStats.totalTexts}}ç¯‡</text>
          <text class="stat-item">â­ æ»¡æ„åº¦{{modernizeStats.satisfaction}}%</text>
        </view>
      </view>

      <view class="ai-feature-card" bindtap="onAIFeatureClick" data-feature="immersive">
        <view class="ai-feature-header">
          <view class="ai-feature-icon">ğŸµ</view>
          <view class="ai-feature-badge">æ²‰æµ¸</view>
        </view>
        <text class="ai-feature-title">æ²‰æµ¸å¼é˜…è¯»</text>
        <text class="ai-feature-desc">AIæœ—è¯»ã€èƒŒæ™¯éŸ³ä¹ã€è§†è§‰æ•ˆæœçš„å¤šæ„Ÿå®˜ä½“éªŒ</text>
        <view class="ai-feature-stats">
          <text class="stat-item">ğŸ§ æ”¯æŒå¤šç§è¯­éŸ³</text>
          <text class="stat-item">ğŸ¨ ä¸°å¯Œè§†è§‰æ•ˆæœ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘ä½¿ç”¨ -->
  <view class="recent-section" wx:if="{{recentUsed.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœ€è¿‘ä½¿ç”¨</text>
    </view>
    <view class="recent-list">
      <view 
        class="recent-item" 
        wx:for="{{recentUsed}}" 
        wx:key="id"
        data-feature="{{item}}"
        bindtap="onFeatureClick"
      >
        <view class="recent-icon" style="background-color: {{item.color}}20;">
          <image src="{{item.icon}}" class="recent-image" mode="aspectFit" />
        </view>
        <view class="recent-info">
          <text class="recent-title">{{item.title}}</text>
          <text class="recent-time">{{item.lastUsed}}</text>
        </view>
        <text class="icon-arrow">â†’</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner">â³</view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && todayRecommend.length === 0 && recentUsed.length === 0}}">
    <view class="empty-icon">ğŸ“š</view>
    <text class="empty-text">æš‚æ— å†…å®¹</text>
  </view>
</view>
