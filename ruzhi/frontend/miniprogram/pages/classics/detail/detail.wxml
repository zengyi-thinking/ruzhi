<!--ç»å…¸è¯¦æƒ…é¡µé¢-->
<view class="detail-container">
  <!-- ä¹¦ç±ä¿¡æ¯å¤´éƒ¨ -->
  <view class="book-header">
    <image class="book-cover" src="{{book.cover}}" mode="aspectFill" />
    <view class="book-info">
      <text class="book-title">{{book.title}}</text>
      <text class="book-author">{{book.author}}</text>
      <text class="book-dynasty">{{book.dynasty}}</text>
      <view class="book-tags">
        <text class="book-tag" wx:for="{{book.tags}}" wx:key="*this">{{item}}</text>
      </view>
      <view class="book-stats">
        <text class="stat-item">{{book.chapters}}ç« </text>
        <text class="stat-item">{{book.readCount}}äººè¯»è¿‡</text>
        <text class="stat-item" wx:if="{{book.progress > 0}}">å·²è¯»{{book.progress}}%</text>
      </view>
    </view>
  </view>

  <!-- ä¹¦ç±æè¿° -->
  <view class="book-description">
    <text class="description-text">{{book.description}}</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn primary-btn" bindtap="onStartReading">
      {{book.progress > 0 ? 'ç»§ç»­é˜…è¯»' : 'å¼€å§‹é˜…è¯»'}}
    </button>
    <button class="action-btn secondary-btn {{book.isFavorite ? 'favorited' : ''}}" bindtap="onToggleFavorite">
      {{book.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—'}}
    </button>
    <button class="action-btn secondary-btn" bindtap="onShare">åˆ†äº«</button>
  </view>

  <!-- ç« èŠ‚åˆ—è¡¨ -->
  <view class="chapters-section">
    <view class="section-header">
      <text class="section-title">ğŸ“– ç« èŠ‚ç›®å½•</text>
      <view class="view-mode">
        <text class="mode-item {{viewMode === 'list' ? 'active' : ''}}" bindtap="onViewModeChange" data-mode="list">åˆ—è¡¨</text>
        <text class="mode-item {{viewMode === 'grid' ? 'active' : ''}}" bindtap="onViewModeChange" data-mode="grid">ç½‘æ ¼</text>
      </view>
    </view>

    <view class="chapters-container {{viewMode}}">
      <view
        class="chapter-item"
        wx:for="{{chapters}}"
        wx:key="id"
        bindtap="onChapterClick"
        data-chapter="{{item}}"
      >
        <view class="chapter-number">{{item.id}}</view>
        <view class="chapter-content">
          <text class="chapter-title">{{item.title}}</text>
          <text class="chapter-preview" wx:if="{{viewMode === 'list'}}">{{item.preview}}</text>
          <view class="chapter-meta">
            <text class="chapter-length">{{item.length}}å­—</text>
            <text class="chapter-time">çº¦{{item.readTime}}åˆ†é’Ÿ</text>
            <view class="chapter-status {{item.status}}">
              <text wx:if="{{item.status === 'unread'}}">æœªè¯»</text>
              <text wx:if="{{item.status === 'reading'}}">é˜…è¯»ä¸­</text>
              <text wx:if="{{item.status === 'completed'}}">å·²å®Œæˆ</text>
            </view>
          </view>
        </view>
        <view class="chapter-progress" wx:if="{{item.progress > 0}}">
          <view class="progress-bar">
            <view class="progress-fill" style="width: {{item.progress}}%"></view>
          </view>
          <text class="progress-text">{{item.progress}}%</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç›¸å…³æ¨è -->
  <view class="recommendations-section" wx:if="{{recommendations.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ“š ç›¸å…³æ¨è</text>
    </view>

    <scroll-view class="recommendations-scroll" scroll-x="true" show-scrollbar="false">
      <view class="recommendations-list">
        <view
          class="recommendation-item"
          wx:for="{{recommendations}}"
          wx:key="id"
          bindtap="onRecommendationClick"
          data-book="{{item}}"
        >
          <image class="rec-cover" src="{{item.cover}}" mode="aspectFill" />
          <text class="rec-title">{{item.title}}</text>
          <text class="rec-author">{{item.author}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å­¦ä¹ ç¬”è®° -->
  <view class="notes-section" wx:if="{{userNotes.length > 0}}">
    <view class="section-header">
      <text class="section-title">ğŸ“ æˆ‘çš„ç¬”è®°</text>
      <text class="view-all" bindtap="onViewAllNotes">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>

    <view class="notes-list">
      <view
        class="note-item"
        wx:for="{{userNotes}}"
        wx:key="id"
      >
        <view class="note-header">
          <text class="note-chapter">{{item.chapterTitle}}</text>
          <text class="note-time">{{item.createTime}}</text>
        </view>
        <text class="note-content">{{item.content}}</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner">â³</view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && chapters.length === 0}}">
    <view class="empty-icon">ğŸ“–</view>
    <text class="empty-title">æš‚æ— ç« èŠ‚å†…å®¹</text>
    <text class="empty-desc">è¯¥ç»å…¸çš„å†…å®¹æ­£åœ¨æ•´ç†ä¸­ï¼Œæ•¬è¯·æœŸå¾…</text>
  </view>
</view>