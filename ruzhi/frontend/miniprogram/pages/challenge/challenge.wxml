<!--AIå…¸ç±é—®ç­”æŒ‘æˆ˜é¡µé¢-->
<view class="challenge-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="header-section">
    <view class="header-bg">
      <view class="header-content">
        <text class="page-title">ğŸ¯ å…¸ç±é—®ç­”æŒ‘æˆ˜</text>
        <text class="page-desc">åœ¨æ¸¸æˆä¸­å­¦ä¹ ï¼Œåœ¨æŒ‘æˆ˜ä¸­æˆé•¿</text>
      </view>
      <view class="user-stats">
        <view class="stat-item">
          <text class="stat-number">{{userStats.totalScore}}</text>
          <text class="stat-label">æ€»ç§¯åˆ†</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userStats.level}}</text>
          <text class="stat-label">ç­‰çº§</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{userStats.streak}}</text>
          <text class="stat-label">è¿èƒœ</text>
        </view>
      </view>
    </view>
  </view>

  <!-- æŒ‘æˆ˜æ¨¡å¼é€‰æ‹© -->
  <view class="modes-section" wx:if="{{currentView === 'modes'}}">
    <view class="section-title">é€‰æ‹©æŒ‘æˆ˜æ¨¡å¼</view>
    
    <view class="modes-grid">
      <view 
        class="mode-card {{item.locked ? 'locked' : ''}}" 
        wx:for="{{challengeModes}}" 
        wx:key="id"
        bindtap="onModeSelect"
        data-mode="{{item}}"
      >
        <view class="mode-icon">{{item.icon}}</view>
        <text class="mode-title">{{item.title}}</text>
        <text class="mode-desc">{{item.description}}</text>
        <view class="mode-meta">
          <text class="mode-difficulty {{item.difficulty}}">{{item.difficultyText}}</text>
          <text class="mode-reward">+{{item.baseReward}}ç§¯åˆ†</text>
        </view>
        <view class="lock-overlay" wx:if="{{item.locked}}">
          <text class="lock-icon">ğŸ”’</text>
          <text class="lock-text">{{item.unlockCondition}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢˜ç›®ç±»å‹é€‰æ‹© -->
  <view class="topics-section" wx:if="{{currentView === 'topics'}}">
    <view class="section-header">
      <text class="section-title">é€‰æ‹©å…¸ç±ç±»å‹</text>
      <text class="back-btn" bindtap="onBackToModes">è¿”å›</text>
    </view>
    
    <view class="topics-grid">
      <view 
        class="topic-card" 
        wx:for="{{topicCategories}}" 
        wx:key="id"
        bindtap="onTopicSelect"
        data-topic="{{item}}"
      >
        <image class="topic-image" src="{{item.image}}" mode="aspectFill" />
        <view class="topic-content">
          <text class="topic-title">{{item.title}}</text>
          <text class="topic-subtitle">{{item.subtitle}}</text>
          <view class="topic-stats">
            <text class="topic-questions">{{item.questionCount}}é¢˜</text>
            <text class="topic-best">æœ€ä½³ï¼š{{item.bestScore || 0}}åˆ†</text>
          </view>
        </view>
        <view class="topic-badge" wx:if="{{item.isNew}}">æ–°</view>
      </view>
    </view>
  </view>

  <!-- æŒ‘æˆ˜è¿›è¡Œä¸­ -->
  <view class="challenge-active" wx:if="{{currentView === 'challenge'}}">
    <!-- è¿›åº¦æ¡ -->
    <view class="progress-section">
      <view class="progress-info">
        <text class="question-counter">{{currentQuestionIndex + 1}}/{{totalQuestions}}</text>
        <text class="score-display">å¾—åˆ†ï¼š{{currentScore}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{(currentQuestionIndex / totalQuestions) * 100}}%"></view>
      </view>
      <view class="time-remaining" wx:if="{{timeLimit > 0}}">
        <text class="time-icon">â°</text>
        <text class="time-text">{{remainingTime}}s</text>
      </view>
    </view>

    <!-- å½“å‰é¢˜ç›® -->
    <view class="question-section" wx:if="{{currentQuestion}}">
      <view class="question-card">
        <view class="question-header">
          <text class="question-type">{{currentQuestion.type}}</text>
          <text class="question-source">ã€Š{{currentQuestion.source}}ã€‹</text>
        </view>
        
        <text class="question-text">{{currentQuestion.question}}</text>
        
        <!-- åŸæ–‡å¼•ç”¨ -->
        <view class="question-quote" wx:if="{{currentQuestion.quote}}">
          <text class="quote-text">{{currentQuestion.quote}}</text>
          <text class="quote-author">â€”â€” {{currentQuestion.author}}</text>
        </view>
        
        <!-- é€‰é¡¹ -->
        <view class="options-list">
          <view 
            class="option-item {{selectedOption === index ? 'selected' : ''}} {{showResult ? (item.correct ? 'correct' : (selectedOption === index ? 'wrong' : '')) : ''}}"
            wx:for="{{currentQuestion.options}}"
            wx:key="*this"
            wx:for-index="index"
            bindtap="onOptionSelect"
            data-index="{{index}}"
          >
            <text class="option-label">{{['A', 'B', 'C', 'D'][index]}}</text>
            <text class="option-text">{{item.text}}</text>
            <view class="option-icon" wx:if="{{showResult}}">
              <text wx:if="{{item.correct}}">âœ“</text>
              <text wx:elif="{{selectedOption === index}}">âœ—</text>
            </view>
          </view>
        </view>

        <!-- è§£æ -->
        <view class="explanation-section" wx:if="{{showResult && currentQuestion.explanation}}">
          <view class="explanation-header">
            <text class="explanation-title">ğŸ“– è¯¦ç»†è§£æ</text>
          </view>
          <text class="explanation-text">{{currentQuestion.explanation}}</text>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="action-buttons">
        <button 
          class="action-btn secondary-btn" 
          bindtap="onSkipQuestion"
          wx:if="{{!showResult && canSkip}}"
        >
          è·³è¿‡ ({{skipCount}}/{{maxSkips}})
        </button>
        
        <button 
          class="action-btn primary-btn" 
          bindtap="onNextQuestion"
          wx:if="{{showResult}}"
        >
          {{currentQuestionIndex < totalQuestions - 1 ? 'ä¸‹ä¸€é¢˜' : 'æŸ¥çœ‹ç»“æœ'}}
        </button>
        
        <button 
          class="action-btn primary-btn" 
          bindtap="onSubmitAnswer"
          disabled="{{selectedOption === null}}"
          wx:if="{{!showResult}}"
        >
          ç¡®è®¤ç­”æ¡ˆ
        </button>
      </view>
    </view>
  </view>

  <!-- æŒ‘æˆ˜ç»“æœ -->
  <view class="result-section" wx:if="{{currentView === 'result'}}">
    <view class="result-card">
      <view class="result-header">
        <text class="result-title">æŒ‘æˆ˜å®Œæˆï¼</text>
        <view class="result-score">
          <text class="score-number">{{finalScore}}</text>
          <text class="score-label">åˆ†</text>
        </view>
      </view>

      <view class="result-stats">
        <view class="result-stat">
          <text class="stat-label">æ­£ç¡®ç‡</text>
          <text class="stat-value">{{accuracy}}%</text>
        </view>
        <view class="result-stat">
          <text class="stat-label">ç”¨æ—¶</text>
          <text class="stat-value">{{usedTime}}s</text>
        </view>
        <view class="result-stat">
          <text class="stat-label">æ’å</text>
          <text class="stat-value">å‰{{ranking}}%</text>
        </view>
      </view>

      <!-- æˆå°±è§£é” -->
      <view class="achievements-unlocked" wx:if="{{unlockedAchievements.length > 0}}">
        <text class="achievements-title">ğŸ† è§£é”æˆå°±</text>
        <view class="achievements-list">
          <view 
            class="achievement-item" 
            wx:for="{{unlockedAchievements}}" 
            wx:key="id"
          >
            <text class="achievement-icon">{{item.icon}}</text>
            <text class="achievement-name">{{item.name}}</text>
          </view>
        </view>
      </view>

      <!-- é”™é¢˜å›é¡¾ -->
      <view class="wrong-questions" wx:if="{{wrongQuestions.length > 0}}">
        <text class="wrong-title">ğŸ“ é”™é¢˜å›é¡¾</text>
        <view class="wrong-list">
          <view 
            class="wrong-item" 
            wx:for="{{wrongQuestions}}" 
            wx:key="id"
            bindtap="onReviewQuestion"
            data-question="{{item}}"
          >
            <text class="wrong-question">{{item.question}}</text>
            <text class="wrong-source">ã€Š{{item.source}}ã€‹</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="result-actions">
        <button class="action-btn secondary-btn" bindtap="onShareResult">åˆ†äº«æˆç»©</button>
        <button class="action-btn primary-btn" bindtap="onRestartChallenge">å†æ¥ä¸€æ¬¡</button>
        <button class="action-btn secondary-btn" bindtap="onBackToModes">è¿”å›é¦–é¡µ</button>
      </view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œ -->
  <view class="leaderboard-section" wx:if="{{currentView === 'leaderboard'}}">
    <view class="section-header">
      <text class="section-title">ğŸ† æ’è¡Œæ¦œ</text>
      <text class="back-btn" bindtap="onBackToModes">è¿”å›</text>
    </view>
    
    <view class="leaderboard-tabs">
      <text 
        class="tab-item {{leaderboardType === item.type ? 'active' : ''}}"
        wx:for="{{leaderboardTabs}}"
        wx:key="type"
        bindtap="onLeaderboardTabChange"
        data-type="{{item.type}}"
      >
        {{item.name}}
      </text>
    </view>

    <view class="leaderboard-list">
      <view 
        class="leaderboard-item {{item.isCurrentUser ? 'current-user' : ''}}"
        wx:for="{{leaderboardData}}"
        wx:key="userId"
      >
        <view class="rank-info">
          <text class="rank-number">{{item.rank}}</text>
          <image class="user-avatar" src="{{item.avatar}}" mode="aspectFill" />
        </view>
        <view class="user-info">
          <text class="user-name">{{item.nickname}}</text>
          <text class="user-level">Lv.{{item.level}}</text>
        </view>
        <view class="score-info">
          <text class="user-score">{{item.score}}</text>
          <text class="score-unit">åˆ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner">â³</view>
    <text class="loading-text">{{loadingText}}</text>
  </view>

  <!-- åº•éƒ¨å¯¼èˆª -->
  <view class="bottom-nav" wx:if="{{currentView === 'modes'}}">
    <view class="nav-item" bindtap="onViewLeaderboard">
      <text class="nav-icon">ğŸ†</text>
      <text class="nav-text">æ’è¡Œæ¦œ</text>
    </view>
    <view class="nav-item" bindtap="onViewHistory">
      <text class="nav-icon">ğŸ“Š</text>
      <text class="nav-text">å†å²è®°å½•</text>
    </view>
    <view class="nav-item" bindtap="onViewAchievements">
      <text class="nav-icon">ğŸ–ï¸</text>
      <text class="nav-text">æˆå°±</text>
    </view>
  </view>
</view>
