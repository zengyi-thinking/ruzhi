<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å„’æ™º - AIæ™ºèƒ½çŸ¥è¯†å›¾è°±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 1rem;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-btn {
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 0.2s;
        }

        .search-btn:hover {
            transform: translateY(-2px);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
        }

        .graph-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .concept-details, .concept-stories, .recommendations {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #667eea;
        }

        .concept-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .concept-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .concept-definition {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .story-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #28a745;
        }

        .story-type {
            background: #28a745;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .story-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .story-content {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
        }

        .expand-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin: 0.5rem 0.5rem 0.5rem 0;
            transition: background 0.3s;
        }

        .expand-btn:hover {
            background: #218838;
        }

        .graph-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #fafafa;
            position: relative;
        }

        .graph-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #666;
            font-size: 1.1rem;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .search-box {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§  AIæ™ºèƒ½çŸ¥è¯†å›¾è°±</h1>
        <p>æ¢ç´¢ä¸­å›½ä¼ ç»Ÿæ–‡åŒ–çš„æ™ºæ…§ç½‘ç»œï¼Œå‘ç°æ¦‚å¿µé—´çš„æ·±å±‚è”ç³»</p>
    </div>

    <div class="container">
        <!-- æœç´¢åŒºåŸŸ -->
        <div class="search-section">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="æœç´¢ä¼ ç»Ÿæ–‡åŒ–æ¦‚å¿µï¼Œå¦‚ï¼šä»ã€é“å¾·ã€ä¿®èº«...">
                <button class="search-btn" onclick="searchConcepts()">ğŸ” æ™ºèƒ½æœç´¢</button>
            </div>
            <div id="searchResults"></div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <!-- çŸ¥è¯†å›¾è°±å¯è§†åŒ–åŒºåŸŸ -->
            <div class="graph-section">
                <h2 class="section-title">ğŸ“Š çŸ¥è¯†å›¾è°±å¯è§†åŒ–</h2>
                <div class="graph-container" id="graphContainer">
                    <div class="graph-placeholder">
                        ç‚¹å‡»æ¦‚å¿µæˆ–æœç´¢ç»“æœæŸ¥çœ‹çŸ¥è¯†å›¾è°±
                    </div>
                </div>
                <div style="margin-top: 1rem;">
                    <button class="expand-btn" onclick="expandGraph('related')">ğŸ”— æ‰©å±•ç›¸å…³æ¦‚å¿µ</button>
                    <button class="expand-btn" onclick="expandGraph('historical')">ğŸ“š å†å²å‘å±•</button>
                    <button class="expand-btn" onclick="expandGraph('practical')">ğŸ¯ å®è·µåº”ç”¨</button>
                </div>
            </div>

            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <!-- æ¦‚å¿µè¯¦æƒ… -->
                <div class="concept-details">
                    <h3 class="section-title">ğŸ“– æ¦‚å¿µè¯¦è§£</h3>
                    <div id="conceptDetails">
                        <p style="color: #666; text-align: center; padding: 2rem;">é€‰æ‹©ä¸€ä¸ªæ¦‚å¿µæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                    </div>
                </div>

                <!-- ç›¸å…³æ•…äº‹ -->
                <div class="concept-stories">
                    <h3 class="section-title">ğŸ“š ç›¸å…³æ•…äº‹</h3>
                    <div id="conceptStories">
                        <p style="color: #666; text-align: center; padding: 2rem;">é€‰æ‹©æ¦‚å¿µåæŸ¥çœ‹ç›¸å…³æ•…äº‹</p>
                    </div>
                </div>

                <!-- æ™ºèƒ½æ¨è -->
                <div class="recommendations">
                    <h3 class="section-title">ğŸ’¡ æ™ºèƒ½æ¨è</h3>
                    <div id="recommendations">
                        <p style="color: #666; text-align: center; padding: 2rem;">åŸºäºæ‚¨çš„å­¦ä¹ å†å²æ¨èç›¸å…³æ¦‚å¿µ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const baseUrl = 'http://localhost:8000';
        let currentConcept = null;
        let graphData = { nodes: [], edges: [] };

        // æœç´¢æ¦‚å¿µ
        async function searchConcepts() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            const resultsDiv = document.getElementById('searchResults');
            resultsDiv.innerHTML = '<div class="loading">ğŸ” æ™ºèƒ½æœç´¢ä¸­...</div>';

            try {
                const response = await fetch(`${baseUrl}/api/v1/knowledge/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.success && data.data.results) {
                    displaySearchResults(data.data.results);
                } else {
                    resultsDiv.innerHTML = '<div class="error">æœç´¢å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                }
            } catch (error) {
                console.error('æœç´¢é”™è¯¯:', error);
                resultsDiv.innerHTML = '<div class="error">æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
            }
        }

        // æ˜¾ç¤ºæœç´¢ç»“æœ
        function displaySearchResults(results) {
            const resultsDiv = document.getElementById('searchResults');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #666;">æœªæ‰¾åˆ°ç›¸å…³æ¦‚å¿µ</p>';
                return;
            }

            let html = '<h4 style="margin: 1rem 0;">æœç´¢ç»“æœï¼š</h4>';
            results.forEach(result => {
                html += `
                    <div class="concept-card" onclick="selectConcept('${result.concept}')">
                        <div class="concept-name">${result.concept}</div>
                        <div class="concept-definition">${result.definition}</div>
                        <div style="margin-top: 0.5rem;">
                            <span style="background: #667eea; color: white; padding: 0.2rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">
                                ${result.category}
                            </span>
                            <span style="margin-left: 0.5rem; color: #666; font-size: 0.9rem;">
                                ç›¸å…³åº¦: ${result.relevance}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        // é€‰æ‹©æ¦‚å¿µ
        async function selectConcept(conceptName) {
            currentConcept = conceptName;
            
            // æ›´æ–°å›¾è°±å¯è§†åŒ–
            updateGraphVisualization(conceptName);
            
            // åŠ è½½æ¦‚å¿µè¯¦æƒ…
            loadConceptDetails(conceptName);
            
            // åŠ è½½ç›¸å…³æ•…äº‹
            loadConceptStories(conceptName);
            
            // æ›´æ–°æ¨è
            updateRecommendations([conceptName]);
        }

        // æ›´æ–°å›¾è°±å¯è§†åŒ–
        function updateGraphVisualization(conceptName) {
            const container = document.getElementById('graphContainer');
            container.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; flex-direction: column;">
                    <div style="font-size: 2rem; margin-bottom: 1rem;">ğŸ¯</div>
                    <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem;">${conceptName}</div>
                    <div style="color: #666;">çŸ¥è¯†å›¾è°±å¯è§†åŒ–</div>
                    <div style="margin-top: 1rem; color: #666; font-size: 0.9rem;">
                        ç‚¹å‡»æ‰©å±•æŒ‰é’®æŸ¥çœ‹ç›¸å…³æ¦‚å¿µ
                    </div>
                </div>
            `;
        }

        // åŠ è½½æ¦‚å¿µè¯¦æƒ…
        async function loadConceptDetails(conceptName) {
            const detailsDiv = document.getElementById('conceptDetails');
            detailsDiv.innerHTML = '<div class="loading">ğŸ“– åŠ è½½æ¦‚å¿µè¯¦æƒ…ä¸­...</div>';

            try {
                const response = await fetch(`${baseUrl}/api/v1/knowledge/concept/${encodeURIComponent(conceptName)}`);
                const data = await response.json();

                if (data.success) {
                    const analysis = data.data.analysis;
                    detailsDiv.innerHTML = `
                        <div style="line-height: 1.6;">
                            ${analysis.replace(/\n/g, '<br>')}
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #eee; font-size: 0.9rem; color: #666;">
                            <div>ç½®ä¿¡åº¦: ${(data.data.confidence * 100).toFixed(1)}%</div>
                            <div>æ¥æº: ${data.data.source === 'deepseek_ai' ? 'DeepSeek AI' : 'å¤‡ç”¨åˆ†æ'}</div>
                        </div>
                    `;
                } else {
                    detailsDiv.innerHTML = '<div class="error">åŠ è½½æ¦‚å¿µè¯¦æƒ…å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ¦‚å¿µè¯¦æƒ…é”™è¯¯:', error);
                detailsDiv.innerHTML = '<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }

        // åŠ è½½ç›¸å…³æ•…äº‹
        async function loadConceptStories(conceptName) {
            const storiesDiv = document.getElementById('conceptStories');
            storiesDiv.innerHTML = '<div class="loading">ğŸ“š åŠ è½½ç›¸å…³æ•…äº‹ä¸­...</div>';

            try {
                const response = await fetch(`${baseUrl}/api/v1/knowledge/concept/${encodeURIComponent(conceptName)}/stories`);
                const data = await response.json();

                if (data.success && data.data.stories) {
                    let html = '';
                    data.data.stories.forEach(story => {
                        html += `
                            <div class="story-card">
                                <div class="story-type">${story.type}</div>
                                <div class="story-title">${story.title}</div>
                                <div class="story-content">${story.content}</div>
                            </div>
                        `;
                    });
                    storiesDiv.innerHTML = html;
                } else {
                    storiesDiv.innerHTML = '<div class="error">åŠ è½½æ•…äº‹å¤±è´¥</div>';
                }
            } catch (error) {
                console.error('åŠ è½½æ•…äº‹é”™è¯¯:', error);
                storiesDiv.innerHTML = '<div class="error">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }

        // æ‰©å±•å›¾è°±
        async function expandGraph(type) {
            if (!currentConcept) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ¦‚å¿µ');
                return;
            }

            const container = document.getElementById('graphContainer');
            container.innerHTML = '<div class="loading">ğŸ”„ æ­£åœ¨æ‰©å±•çŸ¥è¯†å›¾è°±...</div>';

            try {
                const response = await fetch(`${baseUrl}/api/v1/knowledge/concept/${encodeURIComponent(currentConcept)}/expand`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ type: type })
                });

                const data = await response.json();

                if (data.success) {
                    displayExpandedGraph(data.data);
                } else {
                    container.innerHTML = '<div class="error">æ‰©å±•å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
                }
            } catch (error) {
                console.error('æ‰©å±•å›¾è°±é”™è¯¯:', error);
                container.innerHTML = '<div class="error">æ‰©å±•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
            }
        }

        // æ˜¾ç¤ºæ‰©å±•çš„å›¾è°±
        function displayExpandedGraph(data) {
            const container = document.getElementById('graphContainer');
            
            let html = `
                <div style="padding: 1rem;">
                    <h4 style="margin-bottom: 1rem;">ğŸ“Š ${data.source_concept} - ${data.expansion_type} æ‰©å±•</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            `;

            data.expanded_concepts.forEach(concept => {
                html += `
                    <div class="concept-card" onclick="selectConcept('${concept.name}')" style="margin: 0;">
                        <div class="concept-name">${concept.name}</div>
                        <div class="concept-definition">${concept.definition}</div>
                        <div style="margin-top: 0.5rem; font-size: 0.8rem; color: #666;">
                            å…³ç³»: ${concept.relation_to_source} | å¼ºåº¦: ${(concept.strength * 100).toFixed(0)}%
                        </div>
                    </div>
                `;
            });

            html += `
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.9rem; color: #666;">
                        ç½®ä¿¡åº¦: ${(data.confidence * 100).toFixed(1)}% | 
                        æ¥æº: ${data.source === 'deepseek_ai' ? 'DeepSeek AI' : 'å¤‡ç”¨æ‰©å±•'}
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        // æ›´æ–°æ¨è
        function updateRecommendations(concepts) {
            const recDiv = document.getElementById('recommendations');
            recDiv.innerHTML = `
                <div class="concept-card" onclick="selectConcept('é“')">
                    <div class="concept-name">é“</div>
                    <div class="concept-definition">å®‡å®™ä¸‡ç‰©çš„æ ¹æœ¬è§„å¾‹</div>
                </div>
                <div class="concept-card" onclick="selectConcept('å¾·')">
                    <div class="concept-name">å¾·</div>
                    <div class="concept-definition">é“å¾·å“è´¨å’Œç²¾ç¥ä¿®å…»</div>
                </div>
                <div class="concept-card" onclick="selectConcept('ç¤¼')">
                    <div class="concept-name">ç¤¼</div>
                    <div class="concept-definition">è§„èŒƒè¡Œä¸ºçš„å‡†åˆ™</div>
                </div>
            `;
        }

        // æœç´¢æ¡†å›è½¦äº‹ä»¶
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchConcepts();
            }
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.addEventListener('load', function() {
            updateRecommendations([]);
        });
    </script>
</body>
</html>
