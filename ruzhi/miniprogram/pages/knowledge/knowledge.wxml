<!--çŸ¥è¯†å›¾è°±é¡µé¢-->
<view class="page-container traditional-bg">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">ğŸ§  æ™ºèƒ½çŸ¥è¯†å›¾è°±</view>
    <view class="page-subtitle">æ¢ç´¢ä¼ ç»Ÿæ–‡åŒ–æ¦‚å¿µçš„æ·±å±‚è”ç³»</view>
  </view>

  <!-- æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="card">
      <view class="search-box">
        <input 
          class="search-input" 
          placeholder="æœç´¢ä¼ ç»Ÿæ–‡åŒ–æ¦‚å¿µï¼Œå¦‚ï¼šä»ã€é“å¾·ã€ä¿®èº«..."
          value="{{searchQuery}}"
          bindinput="onSearchInput"
          bindconfirm="performSearch"
        />
        <view class="search-btn btn-primary" bindtap="performSearch">
          <text class="search-icon">ğŸ”</text>
        </view>
      </view>
      
      <!-- æœç´¢ç»“æœ -->
      <view class="search-results" wx:if="{{searchResults.length > 0}}">
        <view class="results-title">æœç´¢ç»“æœï¼š</view>
        <view 
          class="result-item" 
          wx:for="{{searchResults}}" 
          wx:key="concept"
          bindtap="selectConcept"
          data-concept="{{item.concept}}"
        >
          <view class="result-content">
            <view class="result-name">{{item.concept}}</view>
            <view class="result-definition">{{item.definition}}</view>
            <view class="result-meta">
              <text class="result-category">{{item.category}}</text>
              <text class="result-relevance">ç›¸å…³åº¦: {{item.relevance}}</text>
            </view>
          </view>
          <view class="result-arrow">â€º</view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ¦‚å¿µ -->
  <view class="concepts-section">
    <view class="card">
      <view class="card-title">ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ</view>
      <view class="concepts-grid">
        <view 
          class="concept-item {{selectedConcept === item.name ? 'active' : ''}}" 
          wx:for="{{coreConcepts}}" 
          wx:key="name"
          bindtap="selectConcept"
          data-concept="{{item.name}}"
        >
          <view class="concept-icon">{{item.icon}}</view>
          <view class="concept-name">{{item.name}}</view>
          <view class="concept-category">{{item.category}}</view>
          <view class="concept-importance">
            <view class="importance-bar">
              <view class="importance-fill" style="width: {{item.importance * 100}}%"></view>
            </view>
            <text class="importance-text">{{(item.importance * 100).toFixed(0)}}%</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¦‚å¿µè¯¦æƒ… -->
  <view class="concept-details" wx:if="{{selectedConcept && conceptAnalysis}}">
    <view class="card">
      <view class="card-title">ğŸ“– æ¦‚å¿µè¯¦è§£ - {{selectedConcept}}</view>
      <view class="analysis-content">
        <text class="analysis-text">{{conceptAnalysis.analysis}}</text>
      </view>
      <view class="analysis-meta">
        <view class="meta-item">
          <text class="meta-label">ç½®ä¿¡åº¦:</text>
          <text class="meta-value">{{(conceptAnalysis.confidence * 100).toFixed(1)}}%</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">æ¥æº:</text>
          <text class="meta-value">{{conceptAnalysis.source === 'deepseek_ai' ? 'DeepSeek AI' : 'å¤‡ç”¨åˆ†æ'}}</text>
        </view>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="concept-actions">
        <view class="action-btn btn-outline btn-small" bindtap="viewStories">ğŸ“š ç›¸å…³æ•…äº‹</view>
        <view class="action-btn btn-success btn-small" bindtap="expandConcept">ğŸ”— æ‰©å±•æ¦‚å¿µ</view>
        <view class="action-btn btn-primary btn-small" bindtap="generateLearningPath">ğŸ¯ å­¦ä¹ è·¯å¾„</view>
      </view>
    </view>
  </view>

  <!-- ç›¸å…³æ¦‚å¿µ -->
  <view class="related-section" wx:if="{{relatedConcepts.length > 0}}">
    <view class="card">
      <view class="card-title">ğŸ”— ç›¸å…³æ¦‚å¿µ</view>
      <view class="related-grid">
        <view 
          class="related-item" 
          wx:for="{{relatedConcepts}}" 
          wx:key="name"
          bindtap="selectConcept"
          data-concept="{{item.name}}"
        >
          <view class="related-name">{{item.name}}</view>
          <view class="related-definition">{{item.definition}}</view>
          <view class="related-relation">
            <text class="relation-type">{{item.relation_to_source}}</text>
            <text class="relation-strength">å¼ºåº¦: {{(item.strength * 100).toFixed(0)}}%</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¦‚å¿µæ•…äº‹ -->
  <view class="stories-section" wx:if="{{conceptStories.length > 0}}">
    <view class="card">
      <view class="card-title">ğŸ“š ç›¸å…³æ•…äº‹</view>
      <view class="stories-list">
        <view class="story-item" wx:for="{{conceptStories}}" wx:key="id">
          <view class="story-header">
            <view class="story-type">{{item.type}}</view>
            <view class="story-title">{{item.title}}</view>
          </view>
          <view class="story-content">{{item.content}}</view>
          <view class="story-moral" wx:if="{{item.moral}}">
            <text class="moral-label">å¯“æ„ï¼š</text>
            <text class="moral-text">{{item.moral}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å­¦ä¹ è·¯å¾„ -->
  <view class="learning-path-section" wx:if="{{learningPath.stages && learningPath.stages.length > 0}}">
    <view class="card">
      <view class="card-title">ğŸ¯ ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„</view>
      <view class="path-overview">
        <text class="path-summary">å…±{{learningPath.total_stages}}ä¸ªé˜¶æ®µï¼Œå¾ªåºæ¸è¿›æŒæ¡ç›¸å…³çŸ¥è¯†</text>
      </view>
      <view class="stages-list">
        <view class="stage-item" wx:for="{{learningPath.stages}}" wx:key="stage_name" wx:for-index="stageIndex">
          <view class="stage-header">
            <view class="stage-number">{{stageIndex + 1}}</view>
            <view class="stage-info">
              <view class="stage-name">{{item.stage_name}}</view>
              <view class="stage-time">é¢„è®¡æ—¶é—´: {{item.estimated_time}}</view>
            </view>
          </view>
          <view class="stage-goal">{{item.learning_goal}}</view>
          <view class="stage-concepts">
            <view class="concept-tag" wx:for="{{item.concepts}}" wx:key="concept" wx:for-item="concept">
              {{concept.concept}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¨èæ¦‚å¿µ -->
  <view class="recommendations-section">
    <view class="card">
      <view class="card-title">ğŸ’¡ æ¨èæ¢ç´¢</view>
      <view class="recommendations-grid">
        <view 
          class="recommendation-item" 
          wx:for="{{recommendations}}" 
          wx:key="concept"
          bindtap="selectConcept"
          data-concept="{{item.concept}}"
        >
          <view class="recommendation-content">
            <view class="recommendation-name">{{item.concept}}</view>
            <view class="recommendation-reason">{{item.reason}}</view>
            <view class="recommendation-meta">
              <text class="recommendation-difficulty">{{item.difficulty}}</text>
              <text class="recommendation-time">{{item.estimated_time}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-icon"></view>
      <view class="loading-text">{{loadingText}}</view>
    </view>
  </view>
</view>
