<!--OCRè¯†åˆ«é¡µé¢-->
<view class="page-container traditional-bg">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <view class="page-title">ğŸ“· OCRå¤ç±è¯†åˆ«</view>
    <view class="page-subtitle">æ™ºèƒ½è¯†åˆ«å¤ç±æ–‡æœ¬ï¼ŒAIæ·±åº¦è§£è¯»</view>
  </view>

  <!-- è¯†åˆ«æ¨¡å¼é€‰æ‹© -->
  <view class="mode-section">
    <view class="card">
      <view class="card-title">ğŸ¯ è¯†åˆ«æ¨¡å¼</view>
      <view class="mode-grid">
        <view 
          class="mode-item {{selectedMode === item.id ? 'active' : ''}}" 
          wx:for="{{ocrModes}}" 
          wx:key="id"
          bindtap="selectMode"
          data-mode="{{item.id}}"
        >
          <view class="mode-icon">{{item.icon}}</view>
          <view class="mode-name">{{item.name}}</view>
          <view class="mode-desc">{{item.description}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
  <view class="upload-section">
    <view class="card">
      <view class="card-title">ğŸ“¸ é€‰æ‹©å›¾ç‰‡</view>
      
      <!-- ä¸Šä¼ æŒ‰é’® -->
      <view class="upload-buttons" wx:if="{{!selectedImage}}">
        <view class="upload-btn btn-primary" bindtap="chooseFromCamera">
          <view class="upload-icon">ğŸ“·</view>
          <view class="upload-text">æ‹ç…§è¯†åˆ«</view>
        </view>
        <view class="upload-btn btn-secondary" bindtap="chooseFromAlbum">
          <view class="upload-icon">ğŸ–¼ï¸</view>
          <view class="upload-text">ç›¸å†Œé€‰æ‹©</view>
        </view>
      </view>

      <!-- å·²é€‰æ‹©çš„å›¾ç‰‡ -->
      <view class="selected-image" wx:if="{{selectedImage}}">
        <image src="{{selectedImage}}" mode="aspectFit" class="preview-image"></image>
        <view class="image-actions">
          <view class="action-btn btn-outline btn-small" bindtap="reSelectImage">é‡æ–°é€‰æ‹©</view>
          <view class="action-btn btn-primary btn-small" bindtap="startRecognition">å¼€å§‹è¯†åˆ«</view>
        </view>
      </view>
    </view>
  </view>

  <!-- è¯†åˆ«ç»“æœ -->
  <view class="result-section" wx:if="{{recognitionResult}}">
    <view class="card">
      <view class="card-title">ğŸ“ è¯†åˆ«ç»“æœ</view>
      
      <!-- è¯†åˆ«æ–‡æœ¬ -->
      <view class="result-text">
        <view class="text-content">{{recognitionResult.text}}</view>
        <view class="result-meta">
          <view class="meta-item">
            <text class="meta-label">ç½®ä¿¡åº¦:</text>
            <text class="meta-value">{{recognitionResult.confidence}}%</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">è¯†åˆ«æ¨¡å¼:</text>
            <text class="meta-value">{{getModeNameById(recognitionResult.mode)}}</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">å¤„ç†æ—¶é—´:</text>
            <text class="meta-value">{{recognitionResult.recognizeTime}}ms</text>
          </view>
        </view>
      </view>

      <!-- æ“ä½œæŒ‰é’® -->
      <view class="result-actions">
        <view class="action-btn btn-outline" bindtap="copyText">ğŸ“‹ å¤åˆ¶æ–‡æœ¬</view>
        <view class="action-btn btn-success" bindtap="interpretText">ğŸ§  AIè§£è¯»</view>
        <view class="action-btn btn-primary" bindtap="saveResult">ğŸ’¾ ä¿å­˜ç»“æœ</view>
      </view>
    </view>
  </view>

  <!-- AIè§£è¯»ç»“æœ -->
  <view class="interpretation-section" wx:if="{{interpretationResult}}">
    <view class="card">
      <view class="card-title">ğŸ§  AIæ™ºèƒ½è§£è¯»</view>
      <view class="interpretation-content">
        <text class="interpretation-text">{{interpretationResult.interpretation}}</text>
      </view>
      <view class="interpretation-meta">
        <view class="meta-item">
          <text class="meta-label">è§£è¯»ç½®ä¿¡åº¦:</text>
          <text class="meta-value">{{(interpretationResult.confidence * 100).toFixed(1)}}%</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">æ¥æº:</text>
          <text class="meta-value">{{interpretationResult.source === 'deepseek_api' ? 'DeepSeek AI' : 'å¤‡ç”¨è§£è¯»'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å†å²è®°å½• -->
  <view class="history-section" wx:if="{{ocrHistory.length > 0}}">
    <view class="card">
      <view class="card-title">ğŸ“š è¯†åˆ«å†å²</view>
      <view class="history-list">
        <view 
          class="history-item" 
          wx:for="{{ocrHistory}}" 
          wx:key="id"
          bindtap="loadHistoryItem"
          data-item="{{item}}"
        >
          <view class="history-content">
            <view class="history-text">{{item.text.substring(0, 30)}}{{item.text.length > 30 ? '...' : ''}}</view>
            <view class="history-meta">
              <text class="history-time">{{item.timestamp}}</text>
              <text class="history-confidence">ç½®ä¿¡åº¦: {{item.confidence}}%</text>
            </view>
          </view>
          <view class="history-arrow">â€º</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-icon"></view>
      <view class="loading-text">{{loadingText}}</view>
    </view>
  </view>
</view>
