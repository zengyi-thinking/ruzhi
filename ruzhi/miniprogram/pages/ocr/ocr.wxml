<!--OCR识别页面-->
<view class="page-container traditional-bg">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="page-title">📷 OCR古籍识别</view>
    <view class="page-subtitle">智能识别古籍文本，AI深度解读</view>
  </view>

  <!-- 识别模式选择 -->
  <view class="mode-section">
    <view class="card">
      <view class="card-title">🎯 识别模式</view>
      <view class="mode-grid">
        <view 
          class="mode-item {{selectedMode === item.id ? 'active' : ''}}" 
          wx:for="{{ocrModes}}" 
          wx:key="id"
          bindtap="selectMode"
          data-mode="{{item.id}}"
        >
          <view class="mode-icon">{{item.icon}}</view>
          <view class="mode-name">{{item.name}}</view>
          <view class="mode-desc">{{item.description}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 图片上传区域 -->
  <view class="upload-section">
    <view class="card">
      <view class="card-title">📸 选择图片</view>
      
      <!-- 上传按钮 -->
      <view class="upload-buttons" wx:if="{{!selectedImage}}">
        <view class="upload-btn btn-primary" bindtap="chooseFromCamera">
          <view class="upload-icon">📷</view>
          <view class="upload-text">拍照识别</view>
        </view>
        <view class="upload-btn btn-secondary" bindtap="chooseFromAlbum">
          <view class="upload-icon">🖼️</view>
          <view class="upload-text">相册选择</view>
        </view>
      </view>

      <!-- 已选择的图片 -->
      <view class="selected-image" wx:if="{{selectedImage}}">
        <image src="{{selectedImage}}" mode="aspectFit" class="preview-image"></image>
        <view class="image-actions">
          <view class="action-btn btn-outline btn-small" bindtap="reSelectImage">重新选择</view>
          <view class="action-btn btn-primary btn-small" bindtap="startRecognition">开始识别</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 识别结果 -->
  <view class="result-section" wx:if="{{recognitionResult}}">
    <view class="card">
      <view class="card-title">📝 识别结果</view>
      
      <!-- 识别文本 -->
      <view class="result-text">
        <view class="text-content">{{recognitionResult.text}}</view>
        <view class="result-meta">
          <view class="meta-item">
            <text class="meta-label">置信度:</text>
            <text class="meta-value">{{recognitionResult.confidence}}%</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">识别模式:</text>
            <text class="meta-value">{{getModeNameById(recognitionResult.mode)}}</text>
          </view>
          <view class="meta-item">
            <text class="meta-label">处理时间:</text>
            <text class="meta-value">{{recognitionResult.recognizeTime}}ms</text>
          </view>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="result-actions">
        <view class="action-btn btn-outline" bindtap="copyText">📋 复制文本</view>
        <view class="action-btn btn-success" bindtap="interpretText">🧠 AI解读</view>
        <view class="action-btn btn-primary" bindtap="saveResult">💾 保存结果</view>
      </view>
    </view>
  </view>

  <!-- AI解读结果 -->
  <view class="interpretation-section" wx:if="{{interpretationResult}}">
    <view class="card">
      <view class="card-title">🧠 AI智能解读</view>
      <view class="interpretation-content">
        <text class="interpretation-text">{{interpretationResult.interpretation}}</text>
      </view>
      <view class="interpretation-meta">
        <view class="meta-item">
          <text class="meta-label">解读置信度:</text>
          <text class="meta-value">{{(interpretationResult.confidence * 100).toFixed(1)}}%</text>
        </view>
        <view class="meta-item">
          <text class="meta-label">来源:</text>
          <text class="meta-value">{{interpretationResult.source === 'deepseek_api' ? 'DeepSeek AI' : '备用解读'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 历史记录 -->
  <view class="history-section" wx:if="{{ocrHistory.length > 0}}">
    <view class="card">
      <view class="card-title">📚 识别历史</view>
      <view class="history-list">
        <view 
          class="history-item" 
          wx:for="{{ocrHistory}}" 
          wx:key="id"
          bindtap="loadHistoryItem"
          data-item="{{item}}"
        >
          <view class="history-content">
            <view class="history-text">{{item.text.substring(0, 30)}}{{item.text.length > 30 ? '...' : ''}}</view>
            <view class="history-meta">
              <text class="history-time">{{item.timestamp}}</text>
              <text class="history-confidence">置信度: {{item.confidence}}%</text>
            </view>
          </view>
          <view class="history-arrow">›</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <view class="loading-icon"></view>
      <view class="loading-text">{{loadingText}}</view>
    </view>
  </view>
</view>
